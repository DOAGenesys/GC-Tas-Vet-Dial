<!DOCTYPE html>
<html>
<head>
    <title>Custom transfer</title>
    <script src="https://sdk-cdn.mypurecloud.com/javascript/55.1.1/purecloud-platform-client-v2.min.js"></script>
    <script>
        const appName = 'myApp';
        const qParamLanguage = 'langTag';
        const qParamEnvironment = 'gcTargetEnv';
        const qParamConversationId = 'conversationId';
        let language = 'en-us';
        let environment = 'mypurecloud.ie';
        let conversationId = '';
        const client = platformClient.ApiClient.instance;

        function assignConfiguration(){
            let url = new URL(window.location);
            let searchParams = new URLSearchParams(url.search);

            if(searchParams.has(qParamLanguage)){
                language = searchParams.get(qParamLanguage);
                localStorage.setItem(`${appName}_language`, language);
            } else {
                let local_lang = localStorage.getItem(`${appName}_language`);
                if(local_lang) language = local_lang;
            }

            if(searchParams.has(qParamEnvironment)){
                environment = searchParams.get(qParamEnvironment);
                localStorage.setItem(`${appName}_environment`, environment);
            } else {
                let local_env = localStorage.getItem(`${appName}_environment`);
                if(local_env) environment = local_env;
            }

            if(searchParams.has(qParamConversationId)){
                conversationId = searchParams.get(qParamConversationId);
            }

            // Set Genesys Cloud region and language
            client.setEnvironment(environment);
            client.setLanguage(language);
        }

        assignConfiguration(); // Call the function to assign language and environment

        client.setAccessToken('4b980e28-662c-4bca-9b81-09d80bc304a3'); // Manually set auth token

        const conversationsApi = new platformClient.ConversationsApi();
        const routingApi = new platformClient.RoutingApi();

        function consultTransfer() {
            // Retrieve queue list
            routingApi.getRoutingQueues()
                .then((data) => {
                    // Populate the dropdown with queue names
                    var select = document.getElementById("queueSelect");
                    for(var i = 0; i < data.entities.length; i++) {
                        var opt = data.entities[i];
                        var el = document.createElement("option");
                        el.textContent = opt.name;
                        el.value = opt.id;
                        select.appendChild(el);
                    }
                })
                .catch((err) => {
                    console.log("Error retrieving queue list");
                    console.error(err);
                });

            var body = {
                "speakTo": document.getElementById("speakToSelect").value,
                "queueId": document.getElementById("queueSelect").value
            };

            // Initiate a consult transfer to a queue
            conversationsApi.postConversationsCallParticipantConsultQueue(interactionId, participantId, body)
                .then((data) => {
                    console.log(`Consult transfer success! data: ${JSON.stringify(data, null, 2)}`);
                })
                .catch((err) => {
                    console.log("Error initiating consult transfer");
                    console.error(err);
                });
        }

        function blindTransfer() {
            var body = {
                // Blind transfer request parameters
            };

            // Replace this participant with the specified queue
            conversationsApi.postConversationParticipantReplaceQueue(interactionId, participantId, body)
                .then(() => {
                    console.log("Blind transfer returned successfully.");
                })
                .catch((err) => {
                    console.log("Error initiating blind transfer");
                    console.error(err);
                });
        }
    </script>
</head>
<body>
    <button onclick="consultTransfer()">Consult Transfer</button>
    <select id="speakToSelect">
        <option value="DESTINATION">DESTINATION</option>
        <option value="OBJECT">OBJECT</option>
        <option value="BOTH">BOTH</option>
        <option value="CONFERENCE">CONFERENCE</option>
    </select>
    <select id="queueSelect"></select>
    <button onclick="blindTransfer()">Blind Transfer</button>
</body>
</html>
